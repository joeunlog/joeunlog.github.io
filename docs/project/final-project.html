<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Final project - Joeunlog</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Final project | Joeunlog</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Final project" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="/docs/project/final-project.html" /> <meta property="og:url" content="/docs/project/final-project.html" /> <meta property="og:site_name" content="Joeunlog" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Final project" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/docs/project/final-project.html","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Final project","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Joeunlog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/docs/" class="nav-list-link">Joeunvit Study log</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/project/" class="nav-list-link">PROJECT</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/project/awseks-semiproject.html" class="nav-list-link">AWS EKS semi project</a></li><li class="nav-list-item active"><a href="/docs/project/final-project.html" class="nav-list-link active">Final project</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/python-study/" class="nav-list-link">Python</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/python-study/01-set-environment.html" class="nav-list-link">Setting environment</a></li><li class="nav-list-item "><a href="/docs/python-study/02-data-type.html" class="nav-list-link">Data type</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/daily-learning-log/" class="nav-list-link">Daily-learning-log</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/daily-learning-log/20210127.html" class="nav-list-link">2021-01-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210128.html" class="nav-list-link">2021-01-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210129.html" class="nav-list-link">2021-01-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210201.html" class="nav-list-link">2021-02-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210205.html" class="nav-list-link">2021-02-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210329.html" class="nav-list-link">2021-03-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210330.html" class="nav-list-link">2021-03-30</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210331.html" class="nav-list-link">2021-03-31</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210401.html" class="nav-list-link">2021-04-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210405.html" class="nav-list-link">2021-04-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210406.html" class="nav-list-link">2021-04-06</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210407.html" class="nav-list-link">2021-04-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210408.html" class="nav-list-link">2021-04-08</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210409.html" class="nav-list-link">2021-04-09</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210420.html" class="nav-list-link">2021-04-20</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210421.html" class="nav-list-link">2021-04-21</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210422.html" class="nav-list-link">2021-04-22</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210423.html" class="nav-list-link">2021-04-23</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210426.html" class="nav-list-link">2021-04-26</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210427.html" class="nav-list-link">2021-04-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210428.html" class="nav-list-link">2021-04-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210429.html" class="nav-list-link">2021-04-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210503.html" class="nav-list-link">2021-05-03</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210504.html" class="nav-list-link">2021-05-04</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210506.html" class="nav-list-link">2021-05-06</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210507.html" class="nav-list-link">2021-05-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210510.html" class="nav-list-link">2021-05-10</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210511.html" class="nav-list-link">2021-05-11</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210512.html" class="nav-list-link">2021-05-12</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210513.html" class="nav-list-link">2021-05-13</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210514.html" class="nav-list-link">2021-05-14</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210517.html" class="nav-list-link">2021-05-17</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210518.html" class="nav-list-link">2021-05-18</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210521.html" class="nav-list-link">2021-05-21</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20211025.html" class="nav-list-link">2021-10-25</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Joeunlog" aria-label="Search Joeunlog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/project/">PROJECT</a></li> <li class="breadcrumb-nav-list-item"><span>Final project</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="subject"> <a href="#subject" class="anchor-heading" aria-labelledby="subject"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Subject </h1> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>virtualenv venv
<span class="nv">$ </span><span class="nb">source</span> /venv/Scripts/activate
</code></pre></div></div> <p>django에서 model을 선언할 때, primary key를 따로 지정하지 않으면<br /> id가 default로 생성된다.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>pip install django-markdownx</p> <h2 id="terraform"> <a href="#terraform" class="anchor-heading" aria-labelledby="terraform"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform </h2> <p>aws configure 설정</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>aws configure
</code></pre></div></div> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>choco <span class="nb">install </span>terraform

<span class="c"># 원하는 폴더에서</span>
<span class="nv">$ </span>terraform init
<span class="nv">$ </span>terraform <span class="nb">fmt</span>
<span class="nv">$ </span>terraform validate
<span class="nv">$ </span>terraform apply
<span class="nv">$ </span>terraform show
<span class="nv">$ </span>terraform destroy
</code></pre></div></div> <p>kubectl이 작동하지 않았음 : kubectl을 configure 해야함</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># configure kubectl</span>
aws eks update-kubeconfig <span class="nt">--region</span> ap-northeast-2 <span class="nt">--name</span> wikikube-cluster
<span class="c"># outputs.tf에 region, cluster_name 선언이 되어 있어야 함</span>
</code></pre></div></div> <p>kubectl describe configmap -n kube-system aws-auth</p> <p>cluster 권한 설정을 위한 사용자 추가</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl edit <span class="nt">-n</span> kube-system configmap/aws-auth

<span class="c"># 예시</span>
apiVersion: v1
data:
  mapRoles: |
    - rolearn: &lt;arn:aws:iam::111122223333:role/eksctl-my-cluster-nodegroup-standard-wo-NodeInstanceRole-1WP3NUE3O6UCF&gt;
      username: &lt;system:node:&gt;
      <span class="nb">groups</span>:
        - &lt;system:bootstrappers&gt;
        - &lt;system:nodes&gt;
  mapUsers: |
    - userarn: &lt;arn:aws:iam::111122223333:user/admin&gt;
      username: &lt;admin&gt;
      <span class="nb">groups</span>:
        - &lt;system:masters&gt;
</code></pre></div></div> <h3 id="addon-설치"> <a href="#addon-설치" class="anchor-heading" aria-labelledby="addon-설치"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> addon 설치 </h3> <h4 id="addon---lb"> <a href="#addon---lb" class="anchor-heading" aria-labelledby="addon---lb"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> addon - lb </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-k</span> <span class="s2">"github.com/aws/eks-charts/stable/aws-load-balancer-controller//crds?ref=master"</span>

helm repo add eks https://aws.github.io/eks-charts

helm repo update

helm upgrade <span class="nt">-i</span> aws-load-balancer-controller eks/aws-load-balancer-controller <span class="se">\</span>
  <span class="nt">--set</span> <span class="nv">clusterName</span><span class="o">=</span>wikikube-cluster <span class="se">\</span>
  <span class="nt">--set</span> serviceAccount.create<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nt">--set</span> serviceAccount.name<span class="o">=</span>aws-load-balancer-controller <span class="se">\</span>
  <span class="nt">--set</span> image.tag<span class="o">=</span>v2.1.3 <span class="se">\</span>
  <span class="nt">-n</span> kube-system

<span class="c"># deploy가 안돼서 rs를 describe 해보니 service account가 없었음</span>
<span class="c"># Error: unable to create iamserviceaccount(s) without IAM OIDC provider enabled</span>
</code></pre></div></div> <blockquote> <p>https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html</p> </blockquote> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># OLDC provider 있는지 확인</span>
aws eks describe-cluster <span class="nt">--name</span> wikikube-cluster <span class="nt">--query</span> <span class="s2">"cluster.identity.oidc.issuer"</span> <span class="nt">--output</span> text    
<span class="c"># output을 아래 command에 넣기 (https ~)</span>
aws iam list-open-id-connect-providers | <span class="nb">grep </span>https://oidc.eks.ap-northeast-2.amazonaws.com/id/E4F7031BF02A0829BC7235585646DCD6
<span class="c"># output이 없으면 새로운 oidc provider 생성</span>
eksctl utils associate-iam-oidc-provider <span class="nt">--cluster</span> wikikube-cluster <span class="nt">--approve</span>
</code></pre></div></div> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 다시 service account 생성 시도하기</span>

<span class="c"># eksctl create iamserviceaccount \</span>
<span class="c">#     --name aws-load-balancer-controller \</span>
<span class="c">#     --namespace kube-system \</span>
<span class="c">#     --cluster test-eks-EV \</span>
<span class="c">#     --attach-policy-arn arn:aws:iam::aws:policy/awsLoadBalancerController \</span>
<span class="c">#     --approve \</span>
<span class="c">#     --override-existing-serviceaccounts</span>
<span class="c"># oidc provider 만들고 시도했는데, override 부분에서 에러가 나는 것 같아서 해당 부분 지우고 시도하니까 sa는 생성됐음</span>
<span class="c"># sa 생성했는데도 안돼서 설치할 때 sa 생성되도록 바꿈 -&gt; 성공 !!!!!!!!!!!!!!!!</span>
helm upgrade <span class="nt">-i</span> aws-load-balancer-controller eks/aws-load-balancer-controller <span class="se">\</span>
  <span class="nt">--set</span> <span class="nv">clusterName</span><span class="o">=</span>wikikube-cluster <span class="se">\</span>
  <span class="nt">--set</span> serviceAccount.create<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nt">--set</span> serviceAccount.name<span class="o">=</span>aws-load-balancer-controller <span class="se">\</span>
  <span class="nt">--set</span> image.tag<span class="o">=</span>v2.1.3 <span class="se">\</span>
  <span class="nt">-n</span> kube-system
</code></pre></div></div> <h4 id="addon---ebs-csi-driver"> <a href="#addon---ebs-csi-driver" class="anchor-heading" aria-labelledby="addon---ebs-csi-driver"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> addon - ebs csi driver </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo add aws-ebs-csi-driver https://kubernetes-sigs.github.io/aws-ebs-csi-driver
helm repo update

<span class="c"># lb 설치할 때처럼 sa를 만들게 바꿈 -&gt; 성공 !!!!!!!!!!</span>
helm upgrade <span class="nt">-install</span> aws-ebs-csi-driver aws-ebs-csi-driver/aws-ebs-csi-driver <span class="se">\</span>
  <span class="nt">--namespace</span> kube-system <span class="se">\</span>
  <span class="nt">--set</span> <span class="nv">enableVolumeResizing</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nt">--set</span> <span class="nv">enableVolumeSnapshot</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nt">--set</span> serviceAccount.controller.create<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nt">--set</span> serviceAccount.controller.name<span class="o">=</span>ebs-csi-controller-sa
</code></pre></div></div> <h4 id="addon---metrics-server"> <a href="#addon---metrics-server" class="anchor-heading" aria-labelledby="addon---metrics-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> addon - metrics server </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</code></pre></div></div> <h4 id="addon---cluster-autoscaler"> <a href="#addon---cluster-autoscaler" class="anchor-heading" aria-labelledby="addon---cluster-autoscaler"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> addon - cluster autoscaler </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-o</span> cluster-autoscaler-autodiscover.yaml https://raw.githubusercontent.com/kubernetes/autoscaler/master/cluster-autoscaler/cloudprovider/aws/examples/cluster-autoscaler-autodiscover.yaml

<span class="c"># edit cluster-autoscaler-autodiscover.yaml</span>
<span class="c"># &lt;YOUR CLUSTER NAME&gt;에 cluster name 입력</span>

kubectl create <span class="nt">-f</span> cluster-autoscaler-autodiscover.yaml
</code></pre></div></div> <h4 id="addon---cloudwatch-container-insights"> <a href="#addon---cloudwatch-container-insights" class="anchor-heading" aria-labelledby="addon---cloudwatch-container-insights"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> addon - cloudwatch container insights </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ ClusterName</span><span class="o">=</span>wikikube-cluster
<span class="nv">$ RegionName</span><span class="o">=</span>ap-northeast-2
<span class="nv">$ FluentBitHttpPort</span><span class="o">=</span><span class="s1">'2020'</span>
<span class="nv">$ FluentBitReadFromHead</span><span class="o">=</span><span class="s1">'Off'</span>

<span class="nv">$ </span><span class="o">[[</span> <span class="k">${</span><span class="nv">FluentBitReadFromHead</span><span class="k">}</span> <span class="o">=</span> <span class="s1">'On'</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">FluentBitReadFromTail</span><span class="o">=</span><span class="s1">'Off'</span><span class="o">||</span> <span class="nv">FluentBitReadFromTail</span><span class="o">=</span><span class="s1">'On'</span>

<span class="nv">$ </span><span class="o">[[</span> <span class="nt">-z</span> <span class="k">${</span><span class="nv">FluentBitHttpPort</span><span class="k">}</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">FluentBitHttpServer</span><span class="o">=</span><span class="s1">'Off'</span> <span class="o">||</span> <span class="nv">FluentBitHttpServer</span><span class="o">=</span><span class="s1">'On'</span>

<span class="nv">$ </span>curl https://raw.githubusercontent.com/aws-samples/amazon-cloudwatch-container-insights/latest/k8s-deployment-manifest-templates/deployment-mode/daemonset/container-insights-monitoring/quickstart/cwagent-fluent-bit-quickstart.yaml | <span class="nb">sed</span> <span class="s1">'s//'</span><span class="k">${</span><span class="nv">ClusterName</span><span class="k">}</span><span class="s1">'/;s//'</span><span class="k">${</span><span class="nv">RegionName</span><span class="k">}</span><span class="s1">'/;s//"'</span><span class="k">${</span><span class="nv">FluentBitHttpServer</span><span class="k">}</span><span class="s1">'"/;s//"'</span><span class="k">${</span><span class="nv">FluentBitHttpPort</span><span class="k">}</span><span class="s1">'"/;s//"'</span><span class="k">${</span><span class="nv">FluentBitReadFromHead</span><span class="k">}</span><span class="s1">'"/;s//"'</span><span class="k">${</span><span class="nv">FluentBitReadFromTail</span><span class="k">}</span><span class="s1">'"/'</span> | kubectl apply <span class="nt">-f</span> - 



</code></pre></div></div> <h4 id="rds-db-django-migrate"> <a href="#rds-db-django-migrate" class="anchor-heading" aria-labelledby="rds-db-django-migrate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> RDS db django migrate </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl run <span class="nb">test</span> <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--image</span><span class="o">=</span>ubuntu:focal
apt update
apt <span class="nb">install </span>python3
apt <span class="nb">install </span>mysql-client
apt <span class="nb">install </span>vim
apt <span class="nb">install </span>pip
pip <span class="nb">install </span>django
apt-get <span class="nb">install </span>libmysqlclient-dev
apt-get <span class="nb">install </span>libssl-dev
pip <span class="nb">install </span>mysqlclient
django-admin startproject dbmigrate
<span class="nb">cd </span>dbmigrate
python3 manage.py startapp k8sdoc
<span class="nb">cd </span>dbmigrate
<span class="c"># setting.py edit</span>
vi setting.py



DATABASES <span class="o">=</span> <span class="o">{</span>
<span class="s1">'default'</span>: <span class="o">{</span>
 <span class="s1">'ENGINE'</span>: <span class="s1">'django.db.backends.mysql'</span>,
 <span class="s1">'NAME'</span>: <span class="s1">'wikikube-db'</span>,
 <span class="s1">'USER'</span>: <span class="s1">'admin'</span>,
 <span class="s1">'PASSWORD'</span>: <span class="s1">'wikikube1214'</span>,
 <span class="s1">'HOST'</span>: <span class="s1">'wikikube-db-1.ckaj95iexfk8.ap-northeast-2.rds.amazonaws.com'</span>, <span class="c"># AWS RDS endpoint</span>
 <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.db import models
from django.db.models.deletion import CASCADE, SET_DEFAULT
from django.contrib.auth.models import User
</code></pre></div></div> <h1 id="django에서-지원하는-user-model-사용"> <a href="#django에서-지원하는-user-model-사용" class="anchor-heading" aria-labelledby="django에서-지원하는-user-model-사용"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> django에서 지원하는 User model 사용 </h1> <h1 id="create-your-models-here"> <a href="#create-your-models-here" class="anchor-heading" aria-labelledby="create-your-models-here"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create your models here. </h1> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class User(models.Model):
    user_id = models.CharField(max_length=200, null=False, primary_key=True)
    user_name = models.CharField(max_length=200, null=False)
    user_password = models.CharField(max_length=200, null=False)
    user_dob = models.DateTimeField(default="", null=False)
    user_create_date = models.DateTimeField(auto_now_add=True, null=False)

    def __str__(self):
        return self.user_name
</code></pre></div></div> <h3 id="게시글에-대한-작성자확인이-필요할까-모든-게시글은-admin이-작성할-것인데"> <a href="#게시글에-대한-작성자확인이-필요할까-모든-게시글은-admin이-작성할-것인데" class="anchor-heading" aria-labelledby="게시글에-대한-작성자확인이-필요할까-모든-게시글은-admin이-작성할-것인데"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 게시글에 대한 작성자확인이 필요할까? 모든 게시글은 admin이 작성할 것인데 </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Post(models.Model):
    title = models.CharField(max_length=100, null=False)
    category = models.CharField(max_length=100, null=False)
    content = models.TextField(max_length=5000, null=False)
    # writer_id = models.ForeignKey(User, on_delete=SET_DEFAULT, default="")
    post_time = models.DateTimeField(auto_now_add=True)

    # def __str__(self):
    #     return str(self.id)

class Comment(models.Model):
    # 고유번호는 comment.id로 참조 : id = models.AutoField(primary_key=True)
    comment_content = models.CharField(max_length=500, null=False)
    com_board_url = models.CharField(max_length=500, null=False)
    user_id = models.ForeignKey(User, on_delete=CASCADE, null=False)
    post_id = models.ForeignKey(Post, on_delete=CASCADE, null=False)    # 게시글 고유번호
    com_create_date = models.DateTimeField(auto_now_add=True, null=False)

    # def __str__(self):
    #     return str(self.id)

class Bookmark(models.Model):
    book_user = models.ForeignKey(User, on_delete=CASCADE, null=False)
    post_id = models.ForeignKey(Post, on_delete=CASCADE, null=True)    # 게시글 고유번호
</code></pre></div></div> <p>Route 53 콘솔을 엽니다.<br /> 탐색 창에서 호스팅 영역을 선택합니다.<br /> 도메인에 대한 호스팅 영역을 선택합니다.<br /> 도메인에 대한 Route 53 별칭 레코드를 선택합니다.<br /> 레코드 세트 편집 창의 유형에서 IPv4 주소를 선택합니다.<br /> 별칭이 예로 설정되어 있는지 확인합니다.<br /> 적절한 Elastic Load Balancing 도메인 이름이 Alias Target으로 설정되어 있는지 확인합니다.<br /> 레코드 세트 저장을 선택합니다.</p> <p>kubectl set image deployment/wikikube -n cd wikikube-pod=kianjay/wikikube:v1.1 –record kubectl set image deployment/wikikube wikikube-pod=kianjay/wikikube:v1.1 –record</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>

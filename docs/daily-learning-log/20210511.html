<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>2021-05-11 - Joeunlog</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>2021-05-11 | Joeunlog</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="2021-05-11" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="/docs/daily-learning-log/20210511.html" /> <meta property="og:url" content="/docs/daily-learning-log/20210511.html" /> <meta property="og:site_name" content="Joeunlog" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="2021-05-11" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/docs/daily-learning-log/20210511.html","headline":"2021-05-11","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Joeunlog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/docs/" class="nav-list-link">Joeunvit Study log</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/python-study/" class="nav-list-link">Python-study</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/python-study/01-set-environment.html" class="nav-list-link">Setting environment</a></li><li class="nav-list-item "><a href="/docs/python-study/02-data-type.html" class="nav-list-link">Data type</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/daily-learning-log/" class="nav-list-link">Daily-learning-log</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/daily-learning-log/20210127.html" class="nav-list-link">2021-01-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210128.html" class="nav-list-link">2021-01-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210129.html" class="nav-list-link">2021-01-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210201.html" class="nav-list-link">2021-02-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210205.html" class="nav-list-link">2021-02-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210329.html" class="nav-list-link">2021-03-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210330.html" class="nav-list-link">2021-03-30</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210331.html" class="nav-list-link">2021-03-31</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210401.html" class="nav-list-link">2021-04-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210405.html" class="nav-list-link">2021-04-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210406.html" class="nav-list-link">2021-04-06</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210407.html" class="nav-list-link">2021-04-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210408.html" class="nav-list-link">2021-04-08</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210409.html" class="nav-list-link">2021-04-09</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210420.html" class="nav-list-link">2021-04-20</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210421.html" class="nav-list-link">2021-04-21</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210422.html" class="nav-list-link">2021-04-22</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210423.html" class="nav-list-link">2021-04-23</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210426.html" class="nav-list-link">2021-04-26</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210427.html" class="nav-list-link">2021-04-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210428.html" class="nav-list-link">2021-04-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210429.html" class="nav-list-link">2021-04-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210503.html" class="nav-list-link">2021-05-03</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210504.html" class="nav-list-link">2021-05-04</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210506.html" class="nav-list-link">2021-05-06</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210507.html" class="nav-list-link">2021-05-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210510.html" class="nav-list-link">2021-05-10</a></li><li class="nav-list-item active"><a href="/docs/daily-learning-log/20210511.html" class="nav-list-link active">2021-05-11</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Joeunlog" aria-label="Search Joeunlog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/daily-learning-log/">Daily-learning-log</a></li> <li class="breadcrumb-nav-list-item"><span>2021-05-11</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1> Kubernetes </h1> <h2> Scheduler </h2> <p>적용 순서</p> <p>nodeName -&gt; nodeSelector -&gt; affinity -&gt; taint</p> <h3> Affinity </h3> <p>참고주소</p> <blockquote> <p>https://kubernetes.io/ko/docs/concepts/scheduling-eviction/assign-pod-node/</p> </blockquote> <p>.spec.affinity 에 정의</p> <ul> <li>종류 <ul> <li>nodeAffinity : node &lt;-&gt; pod : pod가 어떤 node에 속할지 결정 <ul> <li>preferredDuringSchedulingIgnoredDuringExecution : 선호(soft) <ul> <li>해석 : 선호된다 / 스케줄링 되는 중(파드나 컨테이너가 만들어져서 배치되기 전) / 무시된다 / 파드가 실행되고 있는 중</li> <li>preference : Node Label Seletor <ul> <li>matchExpressions</li> <li>matchFields</li> </ul> </li> <li>weight : 가중치 (1~100)</li> </ul> </li> <li>requiredDuringSchedulingIgnoredDuringExecution : 요구(hard) <ul> <li>해석 : 요구된다 / 스케줄링 되는 중(파드나 컨테이너가 만들어져서 배치되기 전) / 무시된다 / 파드가 실행되고 있는 중</li> <li>nodeSelectorTerms : Node Label Seletor <ul> <li>matchExpressions</li> <li>matchFields</li> </ul> </li> <li>weight : 가중치 (1~100</li> </ul> </li> </ul> </li> <li>podAffinity : node(pod+pod) : pod가 다른 특정 pod와 같이 있을지 따로 있을지 결정 <ul> <li>preferredDuringSchedulingIgnoredDuringExecution : 사용 추천 x <ul> <li>podAffinityTerm <ul> <li>labelSelector: Pod label selector</li> <li>topologyKey : 배치 구조 : 노드의 실제 위치 <ul> <li>Node / Rack (온프레미스에서) / AZ (AWS에서) / Group (AWS에서)</li> <li> <p>kubernetes.io/hostname (분류 기준)</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get nodes <span class="nt">-L</span> <span class="s1">'kubernetes.io/hostname'</span>
</code></pre></div> </div> </li> </ul> </li> </ul> </li> <li>weight</li> </ul> </li> <li>requiredDuringSchedulingIgnoredDuringExecution <ul> <li>labelSelector <ul> <li>matchExpressions</li> <li>matchFields</li> </ul> </li> <li>topologyKey</li> </ul> </li> </ul> </li> <li>podAntiAffinity : node(pod)-node(pod) <ul> <li>중요 !! 같은 기능을 하는 app이 하나의 node에 같이 들어있다가 해당 node가 다운되면 그 app들이 전부 다 다운됨 <blockquote> <p>같은 기능을 하는 app끼리 서로 배척하자(따로있자) : anti 다른 기능을 하는 app끼리 서로 선호하자 : affinity (podAffinity) 가장 이상적인건 세트처럼! 각각 다른 노드에 a,b,c / a,b,c 이런식으로!</p> </blockquote> </li> </ul> </li> </ul> </li> </ul> <h4> nodeAffinity 예시 </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: noaff
spec:
  replicas: 2
  selector:
    matchLabels:
      app: noaff
  template:
    metadata:
      labels:
        app: noaff
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: gpu
                operator: In
                values:
                - <span class="s2">"titan"</span>
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference: 
              matchExpressions:
              - key: gpu
                operator: In
                values:
                - <span class="s2">"3090"</span>
            weight: 100
      containers:
      - name: web
        image: nginx
</code></pre></div></div> <h4> pod(Anti)Affinity 예시 </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: antiaff-cache
  labels:
    app: antiaff
spec:
  replicas: 2
  selector:
    matchLabels:
      app: antiaff
      tier: cache
  template:
    metadata:
      labels:
        app: antiaff
        tier: cache
    spec:
      affinity:
        podAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: tier
                operator: In
                values:
                - <span class="s2">"frontend"</span>
            topologyKey: <span class="s2">"kubernetes.io/hostname"</span>
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: tier
                operator: In
                values:
                - <span class="s2">"cache"</span>
            topologyKey: <span class="s2">"kubernetes.io/hostname"</span>
      containers:
      - name: web
        image: nginx
<span class="nt">---</span>
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: antiaff-frontend
  labels:
    app: antiaff
spec:
  replicas: 2
  selector:
    matchLabels:
      app: antiaff
      tier: frontend
  template:
    metadata:
      labels:
        app: antiaff
        tier: frontend
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: tier
                operator: In
                values:
                - <span class="s2">"frontend"</span>
            topologyKey: <span class="s2">"kubernetes.io/hostname"</span>
      containers:
      - name: web
        image: nginx
</code></pre></div></div> <h3> Taint/Toleration </h3> <p>nodename, nodeselector, nodeaffinity의 경우 선택권이 pod에 있는 것과 달리 Taint/Toleration은 노드가 파드를 선택 (이전에는 모두 파드가 노드를 선택하는 거였음)</p> <ul> <li>Taint : 노드가 파드를 제외 : 이 조건이 없으면 그 pod는 실행하지 않겠다! <ul> <li>파드에 toleration이 설정된 것 중에 선택</li> </ul> </li> <li> <p>key - value 형식 : label가 같은 형식이지만 label에 설정하는 것은 아님</p> </li> <li>이게 생각보다 강제적인 것은 아님 일종의 우선순위 개념 ? : 실습하면서, 올바른 toleration을 지정했음에도 불구하고 다른 node에 생성된 경우가 많았음</li> <li> <p>예를 들어, 해당 node의 memory가 꽉 차있거나 하면 당연스레 다른 node에 할당됨</p> </li> <li>effect <ul> <li>NoSchedule: 반드시 스케줄링 X (요청: hard)</li> <li>PreferNoSchedule: 가능하면 스케줄링 X (선호: soft)</li> <li>NoExecute: 실행 X</li> </ul> </li> </ul> <h4> node에 Taint 적용 예시 </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl taint node k8s-w3 <span class="nv">gpu</span><span class="o">=</span>titan:noSchedule
<span class="c"># gpu=titan 톨러레이션이 없으면 스케줄하지 않겠다!</span>
</code></pre></div></div> <h4> Control-plane(master) node의 Taint </h4> <p>node-role.kubernetes.io/master:NoSchedule</p> <ul> <li>해석 <ul> <li>key : node-role.kubernetes.io/master</li> <li>value : 없음 : 없음은 곧 all을 의미</li> <li>effect : NoSchedule</li> </ul> </li> </ul> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl describe nodes k8s-m1
kubectl describe nodes k8s-m1 | <span class="nb">grep </span>Taints
<span class="c"># Taints 항목에 node-role.kubernetes.io/master:NoSchedule가 있다!!</span>
</code></pre></div></div> <h4> pod에 toleration 적용 예시 </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># master에 pod 올리고 싶을 때 toleration 설정</span>
apiVersion: v1
kind: Pod
metadata:
  name: toleration-pod
spec:
  containers:
  - name: web
    image: nginx
  tolerations:
  - key: <span class="s2">"node-role.kubernetes.io/master"</span>
    operator: Exists
    effect: <span class="s2">"NoSchedule"</span>

<span class="c"># 설정한 taint에 맞춰 toleration 설정</span>
apiVersion: v1
kind: Pod
metadata:
  name: toleration-pod
spec:
  containers:
  - name: web
    image: nginx
  tolerations:
  - key: <span class="s2">"gpu"</span>
    operator: Equal
    value: <span class="s2">"titan"</span>
    effect: <span class="s2">"NoSchedule"</span>
</code></pre></div></div> <h4> Static pod </h4> <p>kubernetes가 관리하는 파드가 아님</p> <ul> <li>control plane에서 존재하는 것들 중 systemd 서비스로 존재하는 kubelet과 etcd (systemctl status에서 active된 애들)만 빼고 나머지들은 toleration이 없어도 master에서 실행되고 있다.</li> <li>마찬가지로 nginx-proxy는 각각의 worker node에 자동으로 실행되고 있다.</li> <li>특징 <ul> <li>kind : Pod</li> <li>이름 : PodName-NodeName</li> </ul> </li> <li>master에 있는 static pod 종류 <ul> <li>kube-apiserver-k8s-m1</li> <li>kube-controller-manager-k8s-m1</li> <li>kube-scheduler-k8s-m1</li> </ul> </li> </ul> <blockquote> <p>kubelet은 주기적으로 /etc/kubernetes/manifests 디렉토리에 있는 yaml(kind:Pod) 파일을 읽어서 실행시킨다!</p> </blockquote> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /etc/kubernetes/manifests/
<span class="nb">ls

</span>kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml
<span class="c"># 이 위치에서 yaml 생성해서 test pod 만들면 자동으로 test-k8s-m1 이렇게 이름이 생기고 k8s-m1에서 구동됨</span>
<span class="c"># worker node에서 하더라도 똑같이!</span>
</code></pre></div></div> <p>kubelet 서비스가 docker 서비스에 컨테이너 만들어라 뭐해라 요청하는 것</p> <p>VM을 실행하면 enabled로 설정해놓은 서비스들이 자동으로 실행됨</p> <p>그 중에는 docker, kubelet도 포함</p> <p>각 노드들(마스터 포함)에 있는 kubelet 서비스가 각 컨테이너들을 실행시켜야 kubernetes를 구성하는 cluster의 요소들(static pod)이 다 구동되는 것</p> <p>kubernetes cluster 구성할 때 우리가 kubeadm 으로 init하는데, 이게 static pod 파일을 구성하는 것임</p> <h4> 모든 키와 매칭시키는 방법 </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spec:  
  tolerations:
  - operator: Exists
    effect: <span class="s2">"NoSchedule"</span>
</code></pre></div></div> <h4> 모든 taint를 무시하는 방법 </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spec:
  tolerations:
  - operator: Exists
</code></pre></div></div> <h2> API 접근 </h2> <ul> <li>resource <ul> <li>Role</li> <li>ClusterRole</li> <li>RoleBinding</li> <li>ClusterRoleBinding</li> <li>ServiceAccount</li> <li>CSR(Certificate Signing Request)</li> </ul> </li> </ul> <p>참고주소</p> <blockquote> <p>인증: https://kubernetes.io/docs/reference/access-authn-authz/authentication/</p> </blockquote> <blockquote> <p>인가: https://kubernetes.io/docs/reference/access-authn-authz/authorization/</p> </blockquote> <blockquote> <p>어드미션 컨트롤: https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/</p> </blockquote> <blockquote> <p>RBAC: https://kubernetes.io/docs/reference/access-authn-authz/rbac/</p> </blockquote> <h3> 용어정리 </h3> <ul> <li>Identification(ID): 식별</li> <li>Authentication: 인증 <ul> <li>인증서(x.509), 토큰</li> <li>방법: 패스워드, 인증서, OTP, 생체인증, 토큰 …</li> </ul> </li> <li>Credential: 자격증명</li> <li>Authorization: 인가, 권한부여</li> </ul> <p>Multi Factor Authentication(MFA) : Authy 추천(여러 기기 동기화 사용 가능)</p> <h3> kubernetes에서 다루는 인증 </h3> <ul> <li>인증을 위한 식별 방법 두 가지 <ul> <li>Service Account : 서비스 계정 <ul> <li>resource가 존재 (kubectl api-resources)</li> <li>원래 용도는 사용자가 사용하는 것이 아님 : 서비스가 사용하는 것</li> <li>다만, 사용자가 원하면 사용할 수 있음</li> </ul> </li> <li>User Account : 사용자 계정 <ul> <li>resource가 없다 : kubernetes가 관리하지 않는다</li> <li>사용자가 사용하기 위한 목적 : 서비스가 사용하지 않는다</li> <li>AWS의 IAM과 연동된다</li> </ul> </li> </ul> </li> <li>인증 방법 <ul> <li>x.509 인증서</li> <li>토큰(Service Account가 사용하는 방식)</li> </ul> </li> <li>인가 방법 <ul> <li>ABAC : 사용 x <ul> <li>Attribute-based access-control : 속성 기반</li> <li>변경하게 되면 control plane의 api를 재시작해야함 = 다운타임발생 = 그래서 사용 x</li> </ul> </li> <li>RBAC <ul> <li>Role-based access control : 역할 기반 <ul> <li>Role : 역할 (특정 namespace 한정)</li> <li>ClusterRole : 역할 (cluster 전체)</li> <li>RoleBinding : Role과 Account를 연결 (Service, user 둘 다 가능)</li> <li>ClusterRoleBinding : ClusterRole과 Account를 연결</li> </ul> </li> </ul> </li> </ul> </li> <li>Admission-Control (승인 제어) <ul> <li>유효성 검사</li> <li>오브젝트 리소스 생성, 삭제</li> <li>오브젝트 수정 <ul> <li>우리가 간단하게 pod를 정의하는 yaml를 만들어서 올리면, admission-control이 알아서 지정하지 않은 부분들에 대한 내용을 추가해줌</li> <li>수정된 것들은 etcd에 저장됨</li> </ul> </li> </ul> </li> </ul> <h3> RBAC: Role Based Access Control </h3> <p>서비스(pod) - Service Account - RoleBinding - Role</p> <p>서비스(pod) - Service Account - ClusterRoleBinding - ClusterRole</p> <p>사용자 - RoleBinding - Role</p> <p>사용자 - ClusterRoleBinding - ClusterRole</p> <p>Role이나 ClusterRole에 API에 요청할 수 있는 verb들을 지정해놓고 Rolebinding을 통해 특정 Account가 해당 verb를 사용할 수 있는 권한을 부여</p> <p>예를 들어 pod에 Service Account를 지정해놓고 여러가지 verb를 부여하면, 해당 Pod는 API에 해당 verb로 요청을 할 수 있음</p> <p>pod 생성시 따로 sa를 지정하지 않으면 권한이 부여되지 않은 default sa가 적용됨</p> <h4> Role/ClusterRole </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pod-reader
rules:
- apiGroups:
  nonResourceURLs:
  resources:
  resourceNames:
  verbs:  
</code></pre></div></div> <ul> <li>verbs 종류 <ul> <li>get: 개별 리소스 확인(kubectl get <type> <name>)</name></type></li> <li>list: 여러 리소스 확인(kubectl get <type>)</type></li> <li>watch: 리소스 실시간 확인(–watch)</li> <li>create: 리소스 생성</li> <li>update: 리소스 변경</li> <li>patch: 리소스 일부 변경</li> <li>delete: 개별 리소스 삭제</li> <li>deletecollection: 여러 리소스 삭제</li> </ul> </li> </ul> <h4> RoleBinding/ClusterRoleBinding </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion:
kind:
metadata:
roleRef:
  apiGroup: &lt;Role 리소스 API그룹&gt;
  kind: &lt;Role 리소스 종류&gt;
  name: &lt;Role 리소스 이름&gt;
subjects:
  apiGroup: &lt;사용자 API그룹&gt;
  kind: &lt;사용자 종류&gt;
  name: &lt;사용자 이름&gt;
  namespace: &lt;사용자 NS&gt;
</code></pre></div></div> <h4> Service Account </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: &lt;Account&gt;
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>

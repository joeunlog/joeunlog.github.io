<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>2021-04-07 - Joeunlog</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>2021-04-07 | Joeunlog</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="2021-04-07" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="/docs/daily-learning-log/20210407.html" /> <meta property="og:url" content="/docs/daily-learning-log/20210407.html" /> <meta property="og:site_name" content="Joeunlog" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="2021-04-07" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/docs/daily-learning-log/20210407.html","headline":"2021-04-07","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Joeunlog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/docs/" class="nav-list-link">markdown manual</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/python-study/" class="nav-list-link">Python-study</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/python-study/01-set-environment.html" class="nav-list-link">Setting environment</a></li><li class="nav-list-item "><a href="/docs/python-study/02-data-type.html" class="nav-list-link">Data type</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/daily-learning-log/" class="nav-list-link">Daily-learning-log</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/daily-learning-log/20210127.html" class="nav-list-link">2021-01-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210128.html" class="nav-list-link">2021-01-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210129.html" class="nav-list-link">2021-01-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210201.html" class="nav-list-link">2021-02-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210205.html" class="nav-list-link">2021-02-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210329.html" class="nav-list-link">2021-03-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210330.html" class="nav-list-link">2021-03-30</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210331.html" class="nav-list-link">2021-03-31</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210401.html" class="nav-list-link">2021-04-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210405.html" class="nav-list-link">2021-04-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210406.html" class="nav-list-link">2021-04-06</a></li><li class="nav-list-item active"><a href="/docs/daily-learning-log/20210407.html" class="nav-list-link active">2021-04-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210408.html" class="nav-list-link">2021-04-08</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210409.html" class="nav-list-link">2021-04-09</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210420.html" class="nav-list-link">2021-04-20</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Joeunlog" aria-label="Search Joeunlog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/daily-learning-log/">Daily-learning-log</a></li> <li class="breadcrumb-nav-list-item"><span>2021-04-07</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2> Playbook </h2> <p>연습 - 웹서버 구성</p> <ul> <li>managed1, managed2 서버를 각각 웹 서버, DB 서버로 구성해 보자 <ul> <li>각 서버에 필요한 패키지를 설치</li> <li>서비스 구동</li> <li>방화벽 설정</li> </ul> </li> <li>inventory 구성 (/home/user/practice/inventory)</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nx">webservers</span><span class="p">]</span>
<span class="nx">managed1</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>

<span class="p">[</span><span class="nx">dbservers</span><span class="p">]</span>
<span class="nx">managed2</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>

<span class="p">[</span><span class="nx">allservers</span><span class="p">:</span><span class="nx">children</span><span class="p">]</span>
<span class="nx">webservers</span>
<span class="nx">dbservers</span>
</code></pre></div></div> <ul> <li>ansible.cfg 구성 (/home/user/practice/ansible.cfg)</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nx">defaults</span><span class="p">]</span>
<span class="nx">inventory</span> <span class="o">=</span> <span class="p">.</span><span class="o">/</span><span class="nx">inventory</span>
<span class="nx">remote_user</span> <span class="o">=</span> <span class="nx">user</span>
<span class="nx">ask_pass</span> <span class="o">=</span> <span class="kc">false</span>

<span class="p">[</span><span class="nx">privilege_escalation</span><span class="p">]</span>
<span class="nx">become</span> <span class="o">=</span> <span class="kc">false</span>
<span class="nx">become_method</span> <span class="o">=</span> <span class="nx">sudo</span>
<span class="nx">become_user</span> <span class="o">=</span> <span class="nx">root</span>
<span class="nx">become_ask_pass</span> <span class="o">=</span> <span class="kc">false</span>
</code></pre></div></div> <ul> <li>webservice.yaml 구성 ; prototype (/home/user/practice/webservice.yaml)</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">webserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">httpd</span> <span class="kr">package</span> <span class="nx">is</span> <span class="nx">installed</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="nx">httpd</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">httpd</span> <span class="nx">service</span> <span class="nx">is</span> <span class="nx">enabled</span> <span class="nx">and</span> <span class="nx">started</span>
      <span class="nx">service</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="nx">httpd</span>
        <span class="nx">enabled</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">started</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">firewall</span> <span class="nx">is</span> <span class="nx">opened</span>
      <span class="nx">firewalld</span><span class="p">:</span>
        <span class="nx">service</span><span class="p">:</span> <span class="nx">http</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">enabled</span>
        <span class="nx">permanent</span><span class="p">:</span> <span class="kc">true</span>

<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">dbserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">dbservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">mariadb</span> <span class="kr">package</span> <span class="nx">is</span> <span class="nx">installed</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="nx">mariadb</span><span class="o">-</span><span class="nx">server</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">mariadb</span> <span class="nx">service</span> <span class="nx">is</span> <span class="nx">enabled</span> <span class="nx">and</span> <span class="nx">started</span>
      <span class="nx">service</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="nx">mariadb</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">started</span>
        <span class="nx">enabled</span><span class="p">:</span> <span class="nx">yes</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">firewall</span> <span class="nx">is</span> <span class="nx">opened</span>
      <span class="nx">firewalld</span><span class="p">:</span>
        <span class="nx">service</span><span class="p">:</span> <span class="nx">mysql</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">enabled</span>
        <span class="nx">permanent</span><span class="p">:</span> <span class="nx">yes</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>실행 전 테스트</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">ansible</span><span class="o">-</span><span class="nx">playbook</span> <span class="nx">webservice</span><span class="p">.</span><span class="nx">yaml</span> <span class="o">--</span><span class="nx">syntax</span><span class="o">-</span><span class="nx">check</span>
<span class="nx">$</span> <span class="nx">ansible</span><span class="o">-</span><span class="nx">playbook</span> <span class="nx">webservice</span><span class="p">.</span><span class="nx">yaml</span> <span class="o">--</span><span class="nx">check</span>
</code></pre></div></div> <ul> <li>실행 후 확인</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">ansible</span><span class="o">-</span><span class="nx">playbook</span> <span class="nx">webservice</span><span class="p">.</span><span class="nx">yaml</span>
</code></pre></div></div> <p>변수(Variables)</p> <ul> <li>재사용 할 수 있는 값을 저장하기 위하여 사용 <ul> <li>ex. 설치할 패키지의 이름, 서비스의 이름, 추가할 파일의 경로, 인터넷 경로 주소 …</li> <li>변수 이름 규칙 <ul> <li>사용할 수 있는 글자 : 영문자(대소문자), 숫자, 밑줄</li> <li>문자로 시작해야함</li> </ul> </li> </ul> </li> </ul> <p>변수 적용 범위에 따른 변수의 위치</p> <ul> <li>전역 범위 : 명령줄, Ansible 설정에서 변수를 지정 - ex. ansible-playbook <플레이북 파일명=""> -e “변수이름=변수값” </플레이북> <ul> <li>플레이 : 플레이북의 구조에서 선언 <ul> <li>플레이의 vars 예약어를 사용하여 변수 지정</li> </ul> </li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">webservice</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">webserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">vars</span><span class="p">:</span>
    <span class="kr">package</span><span class="p">:</span> <span class="nx">httpd</span>
    <span class="nx">service</span><span class="p">:</span> <span class="nx">httpd</span>
    <span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">http</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>별도의 파일을 사용하여 변수 지정 : yaml 포맷으로 작성</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">http</span><span class="p">.</span><span class="nx">yaml</span>
<span class="kr">package</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">service</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">http</span>
</code></pre></div></div> <ul> <li>파일을 불러올 때에는 vars_files 예약어를 사용하여 변수가 들어있는 파일을 지정</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">webservice</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">webserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">vars_files</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">http</span><span class="p">.</span><span class="nx">yml</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>호스트/그룹 : 인벤토리 내의 특정 호스트/그룹 <ul> <li>인벤토리 내 특정 호스트에 대한 변수 설정 : 인벤토리 내 호스트 목록 뒤</li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">inventory</span>
<span class="p">[</span><span class="nx">webservers</span><span class="p">]</span>
<span class="nx">managed1</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>  <span class="nx">service</span><span class="o">=</span><span class="nx">httpd</span><span class="p">,</span> <span class="kr">package</span><span class="o">=</span><span class="nx">httpd</span><span class="p">,</span> <span class="nx">firewall_svc</span><span class="o">=</span><span class="nx">http</span>
</code></pre></div></div> <ul> <li>인벤토리 내 특정 그룹에 대한 변수 설정 : [그룹이름:vars] 항목에 표기</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">inventory</span>
<span class="p">[</span><span class="nx">webservers</span><span class="p">]</span>
<span class="nx">managed1</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>

<span class="p">[</span><span class="nx">webservers</span><span class="p">:</span><span class="nx">vars</span><span class="p">]</span>
<span class="nx">service</span><span class="o">=</span><span class="nx">httpd</span>
<span class="kr">package</span><span class="o">=</span><span class="nx">httpd</span>
<span class="nx">firewall_svc</span><span class="o">=</span><span class="nx">http</span>
</code></pre></div></div> <ul> <li>각 호스트에 대한 변수를 별도의 디렉토리(host_vars)에 파일로 저장</li> <li>각 호스트에 대한 변수를 별도의 디렉토리(group_vars)에 파일로 저장 <ul> <li>이러한 파일은 포맷을 yaml형식(변수: 값)으로 작성하며 확장자는 필요 없음</li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span>
<span class="err">├──</span> <span class="nx">ansible</span><span class="p">.</span><span class="nx">cfg</span>
<span class="err">├──</span> <span class="nx">group_vars</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="nx">webservers</span>
<span class="err">├──</span> <span class="nx">host_vars</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="nx">managed1</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>
<span class="err">├──</span> <span class="nx">http</span><span class="p">.</span><span class="nx">yml</span>
<span class="err">├──</span> <span class="nx">inventory</span>
<span class="err">└──</span> <span class="nx">webservice</span><span class="p">.</span><span class="nx">yaml</span>

<span class="nx">$</span> <span class="nx">cat</span> <span class="p">.</span><span class="o">/</span><span class="nx">group_vars</span><span class="o">/</span><span class="nx">webservers</span>
<span class="kr">package</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">service</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">http</span>
</code></pre></div></div> <p>변수 호출</p> <ul> <li>{{ 변수명 }} : 어느 위치에 들어가느냐에 따라 “” 추가 위치가 달라짐 <ul> <li>string이 들어가는 라인의 맨 앞 : 전체 string의 맨 앞과 맨 뒤에 “ ; ex. “ package is installed” <ul> <li>string이 들어가는 라인의 중간 : “ 추가하지 않음 ; ex. firewall service is opened</li> <li>변수 하나만 들어가는 라인 : 변수 앞뒤로 “ ; ex. “”</li> </ul> </li> </ul> </li> <li>플레이범위에서 변수 선언</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">webservice2</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">webserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">vars</span><span class="p">:</span>
    <span class="kr">package</span><span class="p">:</span> <span class="nx">httpd</span>
    <span class="nx">service</span><span class="p">:</span> <span class="nx">httpd</span>
    <span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">http</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> package is installed</span><span class="dl">"</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> service is enabled and started</span><span class="dl">"</span>
      <span class="nx">service</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">enabled</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">started</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">firewall</span>  <span class="nx">service</span> <span class="nx">is</span> <span class="nx">opened</span>
      <span class="nx">firewalld</span><span class="p">:</span>
        <span class="nx">service</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">enabled</span>
        <span class="nx">permanent</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>플레이범위에서 변수 파일 선언</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">http</span><span class="p">.</span><span class="nx">yaml</span>
<span class="kr">package</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">service</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">http</span>

<span class="nx">$</span> <span class="nx">cat</span> <span class="nx">webservice2</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">webserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">vars_files</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">http</span><span class="p">.</span><span class="nx">yml</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> package is installed</span><span class="dl">"</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> service is enabled and started</span><span class="dl">"</span>
      <span class="nx">service</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">enabled</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">started</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">firewall</span>  <span class="nx">service</span> <span class="nx">is</span> <span class="nx">opened</span>
      <span class="nx">firewalld</span><span class="p">:</span>
        <span class="nx">service</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">enabled</span>
        <span class="nx">permanent</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>인벤토리에서 호스트범위, 그룹범위에 변수 선언 <ul> <li>아래 예시의 경우, dbservers그룹에 managed3이 있었다면 service 변수 호출이 되지 않아서 오류가 발생했을 것</li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">inventory</span>
<span class="p">[</span><span class="nx">webservers</span><span class="p">]</span>
<span class="nx">managed1</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>

<span class="p">[</span><span class="nx">dbservers</span><span class="p">]</span>
<span class="nx">managed2</span><span class="p">.</span><span class="nx">example</span><span class="p">.</span><span class="nx">local</span>  <span class="nx">service</span><span class="o">=</span><span class="nx">mariadb</span>	<span class="err">#</span><span class="nx">호스트범위</span> <span class="nx">변수</span> <span class="nx">선언</span> <span class="p">:</span> <span class="nx">해당</span> <span class="nx">호스트</span> <span class="nx">호출시</span> <span class="nx">사용</span>

<span class="p">[</span><span class="nx">dbservers</span><span class="p">:</span><span class="nx">vars</span><span class="p">]</span>	<span class="err">#</span><span class="nx">그룹범위</span> <span class="nx">변수</span> <span class="nx">선언</span> <span class="p">:</span> <span class="nx">해당</span> <span class="nx">그룹에</span> <span class="nx">속하는</span> <span class="nx">호스트</span> <span class="nx">호출시</span> <span class="nx">사용</span>
<span class="kr">package</span><span class="o">=</span><span class="nx">mariadb</span><span class="o">-</span><span class="nx">server</span>
<span class="nx">firewall_svc</span><span class="o">=</span><span class="nx">mysql</span>

<span class="p">[</span><span class="nx">allservers</span><span class="p">:</span><span class="nx">children</span><span class="p">]</span>
<span class="nx">webservers</span>
<span class="nx">dbservers</span>


<span class="nx">$</span> <span class="nx">cat</span> <span class="nx">webservice2</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">dbserver</span> <span class="nx">is</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">dbservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> package is installed</span><span class="dl">"</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> service is enabled and started</span><span class="dl">"</span>
      <span class="nx">service</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">started</span>
        <span class="nx">enabled</span><span class="p">:</span> <span class="nx">yes</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">firewall</span>  <span class="nx">service</span> <span class="nx">is</span> <span class="nx">opened</span>
      <span class="nx">firewalld</span><span class="p">:</span>
        <span class="nx">service</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">enabled</span>
        <span class="nx">permanent</span><span class="p">:</span> <span class="nx">yes</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>특정 디렉토리에 호스트범위, 그룹범위 변수 파일 선언 <ul> <li>아래 예시를 사용하면 webservers와 dbservers 따로 플레이 작성하던 것을 하나로 통합 가능</li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">mkdir</span> <span class="nx">group_vars</span>

<span class="nx">$</span> <span class="nx">cat</span> <span class="o">&gt;</span> <span class="nx">group_vars</span><span class="o">/</span><span class="nx">webservers</span>
<span class="nx">service</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="kr">package</span><span class="p">:</span> <span class="nx">httpd</span>
<span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">http</span>  

<span class="nx">$</span> <span class="nx">cat</span> <span class="o">&gt;</span> <span class="nx">group_vars</span><span class="o">/</span><span class="nx">dbservers</span>
<span class="nx">service</span><span class="p">:</span> <span class="nx">mariadb</span>
<span class="kr">package</span><span class="p">:</span> <span class="nx">mariadb</span><span class="o">-</span><span class="nx">server</span>
<span class="nx">firewall_svc</span><span class="p">:</span> <span class="nx">mysql</span>

<span class="nx">$</span> <span class="nx">cat</span> <span class="nx">webservice2</span><span class="p">.</span><span class="nx">yaml</span> 
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">webservers</span> <span class="nx">and</span> <span class="nx">dbservers</span> <span class="nx">are</span> <span class="nx">ready</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span><span class="p">,</span> <span class="nx">dbservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> package is installed</span><span class="dl">"</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2"> service is enabled and started</span><span class="dl">"</span>
      <span class="nx">service</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">enabled</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">started</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">firewall</span>  <span class="nx">service</span> <span class="nx">is</span> <span class="nx">opened</span>
      <span class="nx">firewalld</span><span class="p">:</span>
        <span class="nx">service</span><span class="p">:</span> <span class="dl">""</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">enabled</span>
        <span class="nx">permanent</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">...</span>
</code></pre></div></div> <p>변수의 배열</p> <ul> <li>ex. 사용자 추가를 위한 변수 선언 <ul> <li>단순 변수 형태</li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user1_id</span>
<span class="nx">user1_uid</span>
<span class="nx">user1_homedir</span>
<span class="nx">user1_login_shell</span>
<span class="nx">user2_id</span>
<span class="nx">user2_uid</span>
<span class="nx">user2_homedir</span>
<span class="nx">user2_login_shell</span>
</code></pre></div></div> <ul> <li>배열 형태</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">user1</span>
	<span class="nx">id</span>
	<span class="nx">uid</span>
	<span class="nx">homedir</span>
	<span class="nx">login_shell</span>
<span class="nx">user2</span>
	<span class="nx">id</span>
	<span class="nx">uid</span>
	<span class="nx">homedir</span>
	<span class="nx">login_shell</span>
</code></pre></div></div> <ul> <li>사용자들이 저장된 배열</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">users</span>
	<span class="nx">user1</span>
		<span class="nx">id</span>
		<span class="nx">uid</span>
		<span class="nx">homedir</span>
		<span class="nx">login_shell</span>
	<span class="nx">user2</span>
		<span class="nx">id</span>
		<span class="nx">uid</span>
		<span class="nx">homedir</span>
		<span class="nx">login_shell</span>
</code></pre></div></div> <p>변수 호출방식</p> <ul> <li>users.user1.id <ul> <li>users[‘user1’][‘id’]</li> </ul> </li> </ul> <p>명령 출력 캡쳐</p> <ul> <li>register : 모듈 실행시 실행 결과를 지정한 이름의 변수에 저장하는 기능 (모듈 내에서 작동하는 기능임) <ul> <li>debug : 변수의 값 등을 출력할 수 있는 모듈</li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">test</span><span class="p">.</span><span class="nx">yaml</span> 
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">register</span> <span class="nx">and</span> <span class="nx">debug</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">become</span><span class="p">:</span> <span class="kc">true</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">install</span> <span class="kr">package</span>
      <span class="nx">yum</span><span class="p">:</span>
        <span class="nx">name</span><span class="p">:</span> <span class="nx">tree</span>
        <span class="nx">state</span><span class="p">:</span> <span class="nx">latest</span>
      <span class="nx">register</span><span class="p">:</span> <span class="nx">result</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">result</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">result</span>
<span class="p">...</span>
</code></pre></div></div> <p>변수의 배열 출력</p> <ul> <li>목록이나 사전을 사용하지 않는 유형</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">vartest</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">variable</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">vars</span><span class="p">:</span>
    <span class="nx">user1_id</span><span class="p">:</span> <span class="nx">alice</span>
    <span class="nx">user1_uid</span><span class="p">:</span> <span class="mi">10000</span>
    <span class="nx">user1_homedir</span><span class="p">:</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span>
    <span class="nx">user2_id</span><span class="p">:</span> <span class="nx">bob</span>
    <span class="nx">user2_uid</span><span class="p">:</span> <span class="mi">10001</span>
    <span class="nx">user2_homedir</span><span class="p">:</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">bob</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">username</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1_id</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">uid</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1_uid</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">home</span> <span class="nx">directory</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1_homedir</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>목록 형태의 변수 유형</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">vartest</span><span class="p">.</span><span class="nx">yaml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">variable</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">vars</span><span class="p">:</span>
    <span class="nx">user1</span><span class="p">:</span>
      <span class="o">-</span> <span class="nx">alice</span>
      <span class="o">-</span> <span class="mi">10000</span>
      <span class="o">-</span> <span class="sr">/home/</span><span class="nx">alice</span>
    <span class="nx">user2</span><span class="p">:</span>
      <span class="o">-</span> <span class="nx">bob</span>
      <span class="o">-</span> <span class="mi">10001</span>
      <span class="o">-</span> <span class="sr">/home/</span><span class="nx">bob</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">username</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">uid</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">home</span> <span class="nx">directory</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>사전 형태의 변수 유형</li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">vartest</span><span class="p">.</span><span class="nx">yaml</span> 
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">variable</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">vars</span><span class="p">:</span>
    <span class="nx">user1</span><span class="p">:</span>
      <span class="nx">id</span><span class="p">:</span> <span class="nx">alice</span>
      <span class="nx">uid</span><span class="p">:</span> <span class="mi">10000</span>
      <span class="nx">homedir</span><span class="p">:</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span>
    <span class="nx">user2</span><span class="p">:</span>
      <span class="nx">id</span><span class="p">:</span> <span class="nx">bob</span>
      <span class="nx">uid</span><span class="p">:</span> <span class="mi">10001</span>
      <span class="nx">homedir</span><span class="p">:</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">bob</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">username</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">]</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">uid</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span><span class="p">.</span><span class="nx">uid</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">home</span> <span class="nx">directory</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span><span class="p">.</span><span class="nx">homedir</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">user1</span>
<span class="p">...</span>
</code></pre></div></div> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">cat</span> <span class="nx">vartest</span><span class="p">.</span><span class="nx">yaml</span> 
<span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">variable</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">vars</span><span class="p">:</span>
    <span class="nx">users</span><span class="p">:</span>
      <span class="nx">user1</span><span class="p">:</span>
        <span class="nx">id</span><span class="p">:</span> <span class="nx">alice</span>
        <span class="nx">uid</span><span class="p">:</span> <span class="mi">10000</span>
        <span class="nx">homedir</span><span class="p">:</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">alice</span>
      <span class="nx">user2</span><span class="p">:</span>
        <span class="nx">id</span><span class="p">:</span> <span class="nx">bob</span>
        <span class="nx">uid</span><span class="p">:</span> <span class="mi">10001</span>
        <span class="nx">homedir</span><span class="p">:</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">bob</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">username</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">users</span><span class="p">[</span><span class="dl">'</span><span class="s1">user1</span><span class="dl">'</span><span class="p">][</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">]</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">uid</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">user1</span><span class="p">.</span><span class="nx">uid</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">user</span> <span class="nx">home</span> <span class="nx">directory</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">users</span><span class="p">.</span><span class="nx">user1</span><span class="p">.</span><span class="nx">homedir</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">users</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">users</span>
<span class="p">...</span>
</code></pre></div></div> <p>팩트 (Ansible Facts)</p> <p>Ansible Facts</p> <ul> <li>Ansible이 대상 시스템으로부터 자동으로 수집한 정보 <ul> <li>수집한 정보를 변수 형태로 저장</li> <li>대상 시스템의 상태를 확인하고 상태에 따라 조치하도록 하기 위하여 사용</li> <li>플레이북을 작성하고 실행 시 기본적으로 각 플레이 시작 단계에서 수행</li> <li>필요에 따라 팩트 수집을 해제할 수 있음 <ul> <li>gather_facts 항목을 플레이에 설정</li> </ul> </li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">variable</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">gather_facts</span><span class="p">:</span> <span class="nx">no</span>
  <span class="nx">tasks</span><span class="p">:</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>필요에 따라 직접 팩트 수집을 수행할 수 있음 : setup (모듈) <ul> <li>ex. ansible -m setup webservers <ul> <li>기본적으로 setup 모듈에 수집할 항목들이 지정되어 있음</li> <li>ansible_facts : setup 모듈에 의해 수집된 팩트 정보가 저장되는 변수</li> <li>ansible_facts.[팩트항목] 혹은 ansible_fact[‘팩트항목’] 형태로 각 팩트에 접근 <ul> <li>hostname : 짧은 호스트 이름 (도메인 이름 제외)</li> <li>fqdn : 전체 호스트 이름 (도메인 이름 포함)</li> <li>default_ipv4.address : 대상의 IP주소 정보</li> <li>interfaces : 네트워크 인터페이스 정보</li> <li>kernel : 커널 정보 (버전)</li> <li>devices.sda.partitions.sda1.size : 장치 정보</li> </ul> </li> </ul> </li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">---</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">Ansible</span> <span class="nx">Facts</span> <span class="nx">test</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">fact</span> <span class="nx">variable</span> <span class="nx">value</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">ansible_facts</span><span class="p">.</span><span class="nx">hostname</span>
<span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">Ansible</span> <span class="nx">Facts</span> <span class="nx">test2</span>
  <span class="nx">hosts</span><span class="p">:</span> <span class="nx">webservers</span>
  <span class="nx">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">print</span> <span class="nx">fact</span> <span class="nx">variable</span> <span class="nx">value</span>
      <span class="nx">debug</span><span class="p">:</span>
        <span class="kd">var</span><span class="p">:</span> <span class="nx">ansible_facts</span><span class="p">[</span><span class="dl">'</span><span class="s1">hostname</span><span class="dl">'</span><span class="p">]</span>
<span class="p">...</span>
</code></pre></div></div> <ul> <li>setup 모듈을 ad-hoc 방식으로 실행할 경우, ansible_facts 변수의 하위 항목이 구식 표기방법으로 표시됨 <ul> <li>ex. ansible_hostname, ansible_fqdn</li> </ul> </li> </ul> <p>사용자 지정 Facts</p> <ul> <li>기본 Ansible Facts와 같이 setup에 의해서 수집되는 데이터를 사용자가 직접 지정 <ul> <li>팩트로 제공할 내용을 managed host에 파일 형태로 미리 작성해놓아야 함 <ul> <li>/etc/ansible/facts.d 디렉토리 내에 .fact로 끝나는 이름으로 작성</li> </ul> </li> </ul> </li> </ul> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nx">root</span><span class="p">@</span><span class="nd">managed1</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="nx">cat</span> <span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">ansible</span><span class="o">/</span><span class="nx">facts</span><span class="p">.</span><span class="nx">d</span><span class="o">/</span><span class="nx">test</span><span class="p">.</span><span class="nx">tact</span>
<span class="p">[</span><span class="nx">users</span><span class="p">]</span>
<span class="nx">user1</span><span class="o">=</span><span class="nx">alice</span>
<span class="nx">user2</span><span class="o">=</span><span class="nx">bob</span>

<span class="p">[</span><span class="nx">webservice</span><span class="p">]</span>
<span class="kr">package</span><span class="o">=</span><span class="nx">httpd</span>
<span class="nx">service</span><span class="o">=</span><span class="nx">httpd</span>
<span class="nx">firewall_svc</span><span class="o">=</span><span class="nx">httpd</span>
</code></pre></div></div> <ul> <li>control node에서 확인 방법 <ul> <li>ansible -m setup webservers | less <ul> <li>/ansible_local 을 입력하면 검색됨</li> </ul> </li> </ul> </li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>

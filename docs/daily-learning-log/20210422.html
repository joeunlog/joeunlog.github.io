<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>2021-04-22 - Joeunlog</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>2021-04-22 | Joeunlog</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="2021-04-22" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="/docs/daily-learning-log/20210422.html" /> <meta property="og:url" content="/docs/daily-learning-log/20210422.html" /> <meta property="og:site_name" content="Joeunlog" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="2021-04-22" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/docs/daily-learning-log/20210422.html","headline":"2021-04-22","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Joeunlog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/docs/" class="nav-list-link">Joeunvit Study log</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/python-study/" class="nav-list-link">Python-study</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/python-study/01-set-environment.html" class="nav-list-link">Setting environment</a></li><li class="nav-list-item "><a href="/docs/python-study/02-data-type.html" class="nav-list-link">Data type</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/daily-learning-log/" class="nav-list-link">Daily-learning-log</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/daily-learning-log/20210127.html" class="nav-list-link">2021-01-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210128.html" class="nav-list-link">2021-01-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210129.html" class="nav-list-link">2021-01-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210201.html" class="nav-list-link">2021-02-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210205.html" class="nav-list-link">2021-02-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210329.html" class="nav-list-link">2021-03-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210330.html" class="nav-list-link">2021-03-30</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210331.html" class="nav-list-link">2021-03-31</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210401.html" class="nav-list-link">2021-04-01</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210405.html" class="nav-list-link">2021-04-05</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210406.html" class="nav-list-link">2021-04-06</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210407.html" class="nav-list-link">2021-04-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210408.html" class="nav-list-link">2021-04-08</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210409.html" class="nav-list-link">2021-04-09</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210420.html" class="nav-list-link">2021-04-20</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210421.html" class="nav-list-link">2021-04-21</a></li><li class="nav-list-item active"><a href="/docs/daily-learning-log/20210422.html" class="nav-list-link active">2021-04-22</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210423.html" class="nav-list-link">2021-04-23</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210426.html" class="nav-list-link">2021-04-26</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210427.html" class="nav-list-link">2021-04-27</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210428.html" class="nav-list-link">2021-04-28</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210429.html" class="nav-list-link">2021-04-29</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210503.html" class="nav-list-link">2021-05-03</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210504.html" class="nav-list-link">2021-05-04</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210506.html" class="nav-list-link">2021-05-06</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210507.html" class="nav-list-link">2021-05-07</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210510.html" class="nav-list-link">2021-05-10</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210511.html" class="nav-list-link">2021-05-11</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210512.html" class="nav-list-link">2021-05-12</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210513.html" class="nav-list-link">2021-05-13</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210514.html" class="nav-list-link">2021-05-14</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210517.html" class="nav-list-link">2021-05-17</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210518.html" class="nav-list-link">2021-05-18</a></li><li class="nav-list-item "><a href="/docs/daily-learning-log/20210521.html" class="nav-list-link">2021-05-21</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Joeunlog" aria-label="Search Joeunlog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/daily-learning-log/">Daily-learning-log</a></li> <li class="breadcrumb-nav-list-item"><span>2021-04-22</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1> Docker </h1> <h2> Docker registry </h2> <p>docker image 저장소</p> <ul> <li>Public Registry : 누구나 pull, 인증받은 사용자 push</li> <li>Private Registry : 인증받은 사용자 pull/push</li> </ul> <p>docker hub 구독 여부에 따라 횟수가 다름</p> <h4> Docker local registry에 push하는 image name </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>localhost:5000/&lt;REPOSITORY&gt;:&lt;TAG
</code></pre></div></div> <h4> Docker hub에 push하는 image name </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker.io/&lt;ACCOUNT&gt;/&lt;REPOSITORY&gt;:&lt;TAG&gt;
<span class="c"># docker.io는 생략 가능</span>
</code></pre></div></div> <h4> github에 push하는 image name </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>github.io/&lt;ACCOUNT&gt;/&lt;REPOSITORY&gt;:&lt;TAG&gt;
</code></pre></div></div> <h4> google cloud registry에 push하는 image name </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>k8s.gcr.io/&lt;REPOSITORY&gt;:&lt;TAG&gt;
</code></pre></div></div> <h4> Amazon ECR </h4> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ACCOUNT&gt;.dkr.ecr.&lt;REGION&gt;.amazonaws.com/&lt;REPOSITORY&gt;:&lt;TAG&gt;
</code></pre></div></div> <h3> Docker local registry에 이미지 올리기 </h3> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag 이미지 localhost:5000/이미지:태그
docker push localhost:5000/이미지:태그
docker pull localhost:5000/이미지:태그
</code></pre></div></div> <h3> Repository image 확인 </h3> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl localhost:5000/v2/_catalog
</code></pre></div></div> <p>태그 목록 확인</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl localhost:5000/v2/&lt;REPOSITORY&gt;/tags/list
</code></pre></div></div> <h2> Harbor </h2> <h3> Harbor 설치 </h3> <p>https://goharbor.io/</p> <blockquote> <blockquote> <p>버전 약어 중 rc = Release Candidate (배포 후보)</p> </blockquote> </blockquote> <p>harbor offline은 다운로드 파일에 component image들이 이미 포함된 것</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>harbor
<span class="nb">cd </span>harbor
wget https://github.com/goharbor/harbor/releases/download/v2.2.1/harbor-online-installer-v2.2.1.tgz
<span class="nb">tar </span>xf harbor-online-installer-v2.2.1.tgz
<span class="nb">cd </span>habor/
<span class="nb">cp </span>harbor.yml.tmpl harbor.yml
vi harbor.yml

hostname을 도커엔진 IP로 변경, https관련 내용들은 주석처리
<span class="c"># Configuration file of Harbor</span>

<span class="c"># The IP address or hostname to access admin UI and registry service.</span>
<span class="c"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span>
<span class="nb">hostname</span>: 192.168.200.10

<span class="c"># http related config</span>
http:
  <span class="c"># port for http, default is 80. If https enabled, this port will redirect to https port</span>
  port: 80

<span class="c"># https related config</span>
<span class="c">#https:</span>
  <span class="c"># https port for harbor, default is 443</span>
  <span class="c">#port: 443</span>
  <span class="c"># The path of cert and key files for nginx</span>
  <span class="c">#certificate: /your/certificate/path</span>
  <span class="c">#private_key: /your/private/key/path</span>

docker info

<span class="c">#Server 맨 아래쪽에 Insecure Registries</span>
<span class="c">#docker engine이랑 docker registry는 http로 통신함</span>
<span class="c">#80포트로 통신을 한다는 뜻</span>
<span class="c">#</span>

<span class="nb">sudo </span>vi /etc/docker/daemon.json

<span class="o">{</span>
        <span class="s2">"insecure-registries"</span> : <span class="o">[</span><span class="s2">"192.168.200.10"</span><span class="o">]</span>
<span class="o">}</span>

<span class="nb">sudo </span>systemctl restart docker

<span class="nb">sudo</span> ./install.sh
<span class="c">#/harbor/harbor에서 해야 함</span>

<span class="nb">sudo </span>docker-compose ps
</code></pre></div></div> <p>크롬 시크릿모드에서 http://192.168.200.10</p> <p>ID:admin</p> <p>PW : Harbor12345</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker login -u admin -p Harbor12345 192.168.200.10
docker tag ubuntu 192.168.200.10/library/ubuntu
docker push 192.168.200.10/library/ubuntu
#harbor에 미리 생성되어 있던 library라는 repository에 ubuntu 이미지를 올림

</code></pre></div></div> <p>새로 올린 이미지를 크롬에서 확인(pull command복사버튼)하면</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>192.168.200.10/library/ubuntu:latest
<span class="c">#위는 태그명으로 표현한 것이고, 아래는 해쉬로 표시한 것</span>
192.168.200.10/library/ubuntu@sha256:5403064f94b617f7975a19ba4d1a1299fd584397f6ee4393d0e16744ed11aab1
<span class="c">#일반적으로 이미지 가져오고 할 때, 제대로 잘 가져왔는지 해쉬값을 비교해서 확인함</span>
</code></pre></div></div> <h1> Kubernetes </h1> <ul> <li>개발/테스트 용 <ul> <li>Docker for Desktop</li> <li>Minikube</li> </ul> </li> <li>프로덕션 : 설치형 <ul> <li>kops : EC2에 설치</li> <li>kubeadm</li> <li>kubespray</li> </ul> </li> <li>프로덕션 : 관리형 <ul> <li>EKS : 비용 발생</li> <li>AKS</li> <li>GKE</li> </ul> </li> </ul> <h2> 시스템의 역할 </h2> <p>참조</p> <p>https://kubernetes.io/ko/docs/concepts/overview/components/</p> <p>Coltrol Plane, node 모두 각각의 시스템 (물리적 혹은 인스턴스)</p> <ul> <li>Control plane : 쿠버네티스 클러스터 전체를 제어하는 노드 : 구) Master Node <ul> <li>Control plane은 꼭 3개 이상의 cluster로 제공되어야 함(복제 필수)</li> <li>Control plane의 etcd : 상태정보를 비롯한 모든 정보들을 저장</li> </ul> </li> <li>Node : 컨테이너를 제공 : 구) minions, worker node <ul> <li>node의 kubelet : 컨테이너 제공</li> <li>node의 k-proxy : 컨테이너의 네트워크 제공</li> </ul> </li> </ul> <p>우리가 구성한 VM은 Control plane이자 node 둘 다 기능을 하게끔 구성할 예정</p> <p>쿠버네티스의 pod가 도커의 컨테이너랑 비슷한 개념</p> <h2> kubeadm으로 Kubernetes 설치 </h2> <p>참조</p> <p>https://kubernetes.io/ko/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> apt-transport-https ca-cerificates curl
<span class="nb">sudo </span>curl <span class="nt">-fsSLo</span> /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
<span class="nb">echo</span> <span class="s2">"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/kubernetes.list
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="nv">kubelet</span><span class="o">=</span>1.19.10-00 <span class="nv">kubeadm</span><span class="o">=</span>1.19.10-00 <span class="nv">kubectl</span><span class="o">=</span>1.19.10-00
<span class="nb">sudo </span>apt-mark hold kubelet kubeadm kubectl

<span class="nb">sudo </span>kubeadm init <span class="nt">--apiserver-advertise-address</span><span class="o">=</span>192.168.200.10 <span class="nt">--pod-network-cidr</span><span class="o">=</span>192.168.0.0/16
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.kube
<span class="nb">sudo cp</span> <span class="nt">-i</span> /etc/kubernetes/admin.conf  <span class="nv">$HOME</span>/.kube/config
<span class="nb">sudo chown</span> <span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span>:<span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span><span class="si">)</span> <span class="nv">$HOME</span>/.kube/config

kubeadm <span class="nb">join </span>192.168.200.10:6443 <span class="nt">--token</span> lgjg8u.64ge20rbkubeadm <span class="nb">join </span>192.168.200.10:6443 <span class="nt">--token</span> izgpsf.36wn2ba5urxz0dq2     <span class="nt">--discovery-token-ca-cert-hash</span> sha256:dff4a90db8a9952d0a57dfe1c818a6435efed4c5b275f9214f912cb4667e5006

kubectl create <span class="nt">-f</span> https://docs.projectcalico.org/manifests/tigera-operator.yaml
kubectl create <span class="nt">-f</span> https://docs.projectcalico.org/manifests/custom-resources.yaml

kubectl get nodes
kubectl get pods <span class="nt">-A</span>
</code></pre></div></div> <p>추천 책 : 쿠버네티스 인 액션 (어려움!!!)</p> <h2> 공부방법에 대하여 </h2> <p>네트워크에서 중요한 것</p> <p>routed protocol : 순수한 네트워크 통신 : 매우 중요 Ethernet, IP, ARP/RARP, ICMP, TCP, UDP, SCTP, HTTP, FTP, SSH, DNS, DHCP, SSL routing protocol : 네트워크 장비에 대한 것 라우터 : RIP, EIGRP, OSPF, BGP, IS-IS 스위치 : STP, VLAN</p> <p>책 : 마스터링 TCP/IP</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
